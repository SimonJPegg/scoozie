version: "0.1"

app.path: "/user/cloudera/test"

actions: {
  start: {
    type:"start"
    ok-to:${actions.mainFork.name}
  }
  mainFork: {
    name:"someFork"
    type:"fork"
    paths: [${actions.hiveAction.name}, ${actions.fsAction.name}] //names of the actions
  }
  hiveAction: {
    name:"hiveAction"
    type: "hive"
    script-name: "hiveScript.hql"
    script-location: ${app.path}/${actions.hiveAction.script-name}
    parameters: []
    files: [${actions.hiveAction.script-name}]
    configuration: {
      test:"one"
    }
    ok-to: ${actions.mainJoin.name}
    error-to: ${actions.errorEmail.name}
  }
  fsAction: {
    name: "fsAction"
    type: "filesystem"
    configuration: {}
    steps: [
      //any of
      {mkdir: ${app.path}/testing},
      {mkdir: ${app.path}/testing2},
      {touchz: ${app.path}/testing/file},
      {chmod: {path:${app.path}/testing/file, permissions:"-rwxrwxrwx", dir-files:"false"}}, //note: Strings
      {move: {source:${app.path}/testing/file,  target:${app.path}/testing2/file }}
      {delete: ${app.path}/testing}
    ]
    ok-to: ${actions.mainJoin.name}
    error-to: ${actions.errorEmail.name}
  }
  mainJoin: {
    name:"mainJoin"
    type:"join"
    ok-to: ${actions.shellAction.name}
  }
  shellAction: {
    name:"shellAction"
    type:"shell"
    script-name: "bashScript.sh"
    script-location: ${app.path}/${actions.shellAction.script-name}
    command-line-arguments: ["one","two"]
    capture-output: true
    environment-variables: []
    files: []
    configuration: {}
    ok-to: ${actions.distCPAction.name}
    error-to: ${actions.errorEmail.name}
    sla:  {
      nominal-time: "${nominalTime}"
      should-start: "1"
      should-end: "1"
      max-duration: "1"
      alert-events: ["start_miss", "end_miss","duration_miss"]
      alert-contacts: ["alert@oozie.com"]
      notification-message: "Notification Message"
      upstream-applications: ["application-a","application-b"]
    }
  }
  distCPAction: {
    name: "distCPAction"
    type: "distcp"
    arguments: [${app.path}/testing2/file, ${app.path}/testing3/file]
    java-options: ""
    configuration: {}
    prepare: {
      delete: ${app.path}/testing3
      mkdir: ${app.path}/testing3
    }
    ok-to: ${actions.end.name}
    error-to: ${actions.errorEmail.name}
  }
  errorEmail: {
    name:"errorEmail"
    type:"email"
    to: ["a@a.com"]
    cc: []
    subject: "hello"
    body: "yep"
    ok-to: ${actions.kill.name}
    error-to: ${actions.kill.name}
  }
  kill: {
    name: "kill"
    type: "kill"
    message: "workflow is kill"
  }
  end: {
    name: "end"
    type:"end"
  }
}

workflow {
  name: "testWorkflow"
  path: ${app.path}
  transitions: [
    ${actions.start},
    ${actions.mainFork},
    ${actions.hiveAction},
    ${actions.fsAction},
    ${actions.mainJoin},
    ${actions.shellAction},
    ${actions.distCPAction},
    ${actions.errorEmail},
    ${actions.kill},
    ${actions.end}
  ]
  configuration: {
    workflow1:"value1",
    workflow2:"value2",
    workflow3:"value3",
    workflow4:"value4"
  }
  yarn-config {
    name-node: "hdfs://quickstart.cloudera"
    job-tracker: "quickstart.cloudera:8032"
  }
}
coordinator: {
  name: "testCoordinator"
  path: ${app.path}
  frequency: "coord:hours(1)"
  start: "2019-01-01T00:00Z"
  end: "2019-01-01T04:00Z"
  timezone: "Europe/London"
  configuration: {
    nominalTime: "coord:nominalTime()"
  }
}